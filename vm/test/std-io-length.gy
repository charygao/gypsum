// Copyright 2016 Jay Conrod. All rights reserved.

// This file is part of CodeSwitch. Use of this source code is governed by
// the 3-clause BSD license that can be found in the LICENSE.txt file.


import std.I8Array
import std.io.File, FileInputStream, InputStream

def read-stream(stream: InputStream): i64 =
  var total-length = 0i64
  let buffer = new(4096i32) I8Array()
  var done = false
  while (!done)
    let length = stream.read(buffer, 0i32, buffer.length)
    if (length == 0i32)
      done = true
      {}
    else
      total-length += length.to-i64
      {}
  total-length

def main =
  let file = File("/bin/ls")
  let file-stream = FileInputStream(file)
  let length = read-stream(file-stream)
  if (file.size != length)
    throw Exception()
